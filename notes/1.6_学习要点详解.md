# 第1.6章：直方图与散点图 - 超详细解释

## 📊 第一部分：日收益率（Daily Returns）

### 什么是日收益率？

**生活化理解：**
想象你买了一只股票：
- 昨天价格：100元
- 今天价格：105元
- **日收益率 = (105/100) - 1 = 0.05 = 5%**

如果今天价格是95元：
- **日收益率 = (95/100) - 1 = -0.05 = -5%**（亏了5%）

### 为什么要计算日收益率？

**问题：** 股票A从100元涨到110元，股票B从10元涨到11元，哪个涨得多？
- 看起来A涨了10元，B只涨了1元
- 但实际上：A涨了10%，B也涨了10%！**收益率相同**

**结论：** 收益率让我们可以公平比较不同价格的股票

### 公式详解

```python
daily_returns[1:] = (df[1:] / df[:-1].values) - 1
```

**拆解：**
- `df[1:]` = 今天及以后的价格
- `df[:-1]` = 昨天及以前的价格
- `df[1:] / df[:-1]` = 今天价格 ÷ 昨天价格（得到倍数）
- `- 1` = 减去1，得到增长率

**例子：**
```
日期        价格    计算过程              日收益率
1月1日      100     (第一行，设为0)       0%
1月2日      105     (105/100) - 1 = 0.05  5%
1月3日      98      (98/105) - 1 = -0.067 -6.7%
1月4日      102     (102/98) - 1 = 0.041  4.1%
```

---

## 📈 第二部分：直方图（Histogram）

### 什么是直方图？

**生活化理解：**
想象你记录了100天的股票收益率，直方图就是把这些收益率"分类统计"：

```
收益率范围        出现天数（柱子高度）
-5% 到 -3%       5天  ████
-3% 到 -1%       15天  ████████████████
-1% 到 1%        50天  ████████████████████████████████████████████████
1% 到 3%         20天  ████████████████████
3% 到 5%         8天   ████████
5% 到 7%         2天   ██
```

**直方图告诉你：**
- 大部分时候收益率在-1%到1%之间（正常波动）
- 偶尔会有大涨大跌（极端情况）

### 为什么用直方图？

**问题：** 只看价格曲线，你只能看到"涨了"或"跌了"，但看不到：
- 涨跌的幅度分布
- 极端情况出现的频率
- 风险大小

**直方图帮你看到：**
1. **分布形状**：是正态分布（钟形）还是偏斜？
2. **风险大小**：柱子越分散 = 波动越大 = 风险越高
3. **极端事件**：尾部有多长 = 极端涨跌的频率

### Bins（分组数）的作用

**bins=10：** 分成10组，每组范围大，细节少
```
-10%到-8%, -8%到-6%, -6%到-4%, ... 8%到10%
```

**bins=20：** 分成20组，每组范围小，细节多
```
-10%到-9%, -9%到-8%, -8%到-7%, ... 9%到10%
```

**选择原则：**
- bins太少：看不清细节
- bins太多：太琐碎，看不清整体
- **通常用20个bins比较合适**

---

## 📊 第三部分：统计指标（Mean, Std, Kurtosis）

### 1. 均值（Mean）- 平均收益率

**生活化理解：**
你100天的收益率加起来除以100，就是平均每天赚（或亏）多少

**例子：**
```
100天的收益率：+2%, -1%, +0.5%, -0.3%, +1.2%, ...
均值 = 0.05% = 平均每天赚0.05%
```

**在直方图上：**
- 均值用**白色虚线**标记
- 如果均值在0的右边 = 总体赚钱
- 如果均值在0的左边 = 总体亏钱

### 2. 标准差（Std）- 波动率/风险

**生活化理解：**
标准差衡量"收益率有多分散"
- **标准差小** = 收益率都集中在均值附近 = **风险低，稳定**
- **标准差大** = 收益率分散，有时大涨有时大跌 = **风险高，不稳定**

**例子对比：**
```
股票A（稳定）：收益率总是在 0% ± 1% 之间
标准差 = 0.5%  → 风险低

股票B（波动大）：收益率在 -5% 到 +5% 之间乱跳
标准差 = 3%    → 风险高
```

**在直方图上：**
- 标准差用**红色虚线**标记（+std 和 -std）
- 柱子越集中在均值附近 = 标准差越小 = 风险越小
- 柱子越分散 = 标准差越大 = 风险越大

**实际意义：**
- 如果收益率在 ±1个标准差内 = 68%的概率（正常情况）
- 如果收益率在 ±2个标准差外 = 极端情况（很少见）

### 3. 峰度（Kurtosis）- 尾部风险

**生活化理解：**
峰度衡量"极端事件出现的频率"

**对比：**
```
正态分布（Kurtosis = 3）：
- 大部分收益率在中间
- 极端涨跌很少见
- 像"钟形"曲线

高峰度（Kurtosis > 3）：
- 大部分收益率在中间
- 但极端涨跌比预期多！
- 像"尖峰厚尾"（中间尖，两边厚）
```

**实际意义：**
- **Kurtosis = 3**：正常，极端事件符合预期
- **Kurtosis > 3**：**危险！** 极端涨跌比预期多，风险高
- **Kurtosis < 3**：极端事件比预期少，相对安全

**例子：**
```
股票A：Kurtosis = 2.5
→ 极端事件少，相对安全

股票B：Kurtosis = 5.0
→ 极端事件多！可能突然大涨或大跌
→ 投资需谨慎
```

---

## 📊 第四部分：散点图（Scatterplots）与相关性

### 什么是散点图？

**生活化理解：**
把两只股票每天的收益率画成点：
- X轴 = SPY（市场）的收益率
- Y轴 = XOM（某只股票）的收益率

**例子：**
```
某一天：
SPY涨了2%，XOM涨了2.5%  → 画一个点 (2%, 2.5%)
另一天：
SPY跌了1%，XOM跌了1.2%  → 画一个点 (-1%, -1.2%)
...
画100个点，看它们的关系
```

### 散点图的形状告诉你什么？

**1. 点聚集在一条线上（正相关）**
```
    XOM收益率
      ↑
      |    ●
      |  ● ●
      |● ● ●
      |● ● ●
      +--------→ SPY收益率
```
**含义：** SPY涨，XOM也涨；SPY跌，XOM也跌
**结论：** 两只股票**同向运动**，相关性高

**2. 点分散（不相关）**
```
    XOM收益率
      ↑
      |  ●   ●
      |    ●   ●
      |  ●   ●
      |    ●
      +--------→ SPY收益率
```
**含义：** SPY涨跌，XOM不一定跟着涨跌
**结论：** 两只股票**独立**，相关性低

**3. 点向下倾斜（负相关）**
```
    XOM收益率
      ↑
      |●
      |  ●
      |    ●
      |      ●
      +--------→ SPY收益率
```
**含义：** SPY涨，XOM跌；SPY跌，XOM涨
**结论：** 两只股票**反向运动**（很少见）

### Beta（β）- 市场敏感度

**生活化理解：**
Beta衡量"市场涨1%，这只股票涨多少？"

**公式：**
```
Y = Beta × X + Alpha
XOM收益率 = Beta × SPY收益率 + Alpha
```

**Beta值的含义：**

| Beta值 | 含义 | 例子 |
|--------|------|------|
| **Beta = 1.0** | 与市场同步 | SPY涨2%，股票也涨2% |
| **Beta > 1.0** | 比市场波动大 | SPY涨2%，股票涨3%（更激进） |
| **Beta < 1.0** | 比市场波动小 | SPY涨2%，股票涨1%（更保守） |
| **Beta = 0** | 与市场无关 | SPY涨跌，股票不受影响 |
| **Beta < 0** | 与市场反向 | SPY涨，股票跌（很少见） |

**实际应用：**
```
股票A：Beta = 1.5
→ 市场涨10%，它可能涨15%
→ 市场跌10%，它可能跌15%
→ **高风险高收益**

股票B：Beta = 0.7
→ 市场涨10%，它可能涨7%
→ 市场跌10%，它可能跌7%
→ **低风险低收益**
```

**在散点图上：**
- Beta = **回归线的斜率**
- 线越陡 = Beta越大 = 波动越大
- 线越平 = Beta越小 = 波动越小

### Alpha（α）- 超额收益

**生活化理解：**
Alpha衡量"即使市场不动，这只股票也能赚多少？"

**公式：**
```
Y = Beta × X + Alpha
```

**Alpha值的含义：**

| Alpha值 | 含义 |
|---------|------|
| **Alpha > 0** | 有超额收益（好股票！） |
| **Alpha = 0** | 没有超额收益（正常） |
| **Alpha < 0** | 表现不如市场（差股票） |

**实际例子：**
```
股票A：Alpha = 0.001（0.1%）
→ 即使市场不动，每天也能多赚0.1%
→ 一年下来多赚约25%（复利）

股票B：Alpha = -0.0005（-0.05%）
→ 即使市场不动，每天也会亏0.05%
→ 表现不如市场
```

**注意：**
- 在现实中，Alpha通常接近0（因为市场是有效的）
- 如果Alpha长期>0，说明这只股票有"超额能力"

---

## 🎯 实际应用场景

### 场景1：评估单只股票的风险

**步骤：**
1. 计算日收益率
2. 画直方图
3. 看标准差（Std）
   - Std小 = 风险低
   - Std大 = 风险高
4. 看峰度（Kurtosis）
   - Kurtosis > 3 = 极端事件多，需谨慎

**决策：**
- 风险承受能力低 → 选Std小、Kurtosis小的股票
- 追求高收益 → 可以接受Std大、Kurtosis大的股票

### 场景2：构建投资组合（降低风险）

**问题：** 如何选择两只股票，让组合风险最小？

**方法：**
1. 画散点图，看两只股票的相关性
2. 如果点很分散（相关性低）→ **好！** 可以降低风险
3. 如果点聚集在一条线上（相关性高）→ **不好！** 风险不能分散

**例子：**
```
组合A：SPY + XOM（都是股票，相关性高）
→ 市场跌，两只都跌
→ 风险不能分散

组合B：SPY + GLD（股票 + 黄金，相关性低）
→ 市场跌，SPY跌但GLD可能涨
→ 风险可以分散
```

### 场景3：选择适合的股票

**根据Beta选择：**
- **保守投资者** → 选Beta < 1的股票（波动小）
- **激进投资者** → 选Beta > 1的股票（波动大，可能收益高）

**根据Alpha选择：**
- **长期投资** → 选Alpha > 0的股票（有超额收益）
- **短期投机** → Alpha不重要，主要看Beta和波动

---

## 📝 快速记忆口诀

1. **日收益率** = (今天/昨天) - 1，用来公平比较
2. **直方图** = 看收益率分布，判断风险
3. **均值** = 平均赚多少，白色虚线
4. **标准差** = 波动大小，红色虚线，越大越危险
5. **峰度** = 极端事件频率，>3要小心
6. **散点图** = 看两只股票的关系
7. **Beta** = 市场敏感度，>1波动大，<1波动小
8. **Alpha** = 超额收益，>0是好股票

---

## 🔍 考试/作业常见问题

### Q1: 如何计算日收益率？
**A:** `(price[t] / price[t-1]) - 1`
- 第一行设为0（没有前一天）

### Q2: Beta = 1.5 意味着什么？
**A:** 市场涨1%，这只股票涨1.5%
- 波动比市场大，风险高但可能收益也高

### Q3: 如何用直方图判断风险？
**A:** 
- 看标准差（Std）：越大越危险
- 看峰度（Kurtosis）：>3说明极端事件多
- 看分布形状：越分散越危险

### Q4: 散点图如何反映两只股票的关系？
**A:**
- 点聚集在一条线上 = 相关性高（同向运动）
- 点分散 = 相关性低（独立）
- 线越陡 = Beta越大 = 波动越大

### Q5: 为什么投资组合要选相关性低的股票？
**A:** 相关性低 = 一只跌时另一只可能涨 = 可以分散风险

---

## 💡 总结

**核心思想：**
1. **日收益率**让我们公平比较不同股票
2. **直方图**展示收益率的分布，帮我们评估风险
3. **统计指标**（均值、标准差、峰度）量化风险
4. **散点图**展示股票间的关系
5. **Beta和Alpha**帮助我们理解和选择股票

**实际应用：**
- 评估单只股票的风险
- 构建低风险的投资组合
- 选择适合自己风险偏好的股票

**记住：** 在AI时代，你不需要死磕代码，但需要理解这些概念，这样才能：
- 看懂分析结果
- 做出正确决策
- 在考试/作业中回答概念性问题
